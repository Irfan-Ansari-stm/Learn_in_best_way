<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>13.1 – Prototype Chain in JavaScript</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
:root{
    --bg-main:#050816;
    --bg-sidebar:#060b18;
    --accent-cyan:#22d3ee;
    --accent-amber:#fbbf24;
    --text-main:#e5e7eb;
    --text-muted:#9ca3af;
    --border-subtle:#1f2937;
    --code-bg:#020617;
}

/* Base */
*{box-sizing:border-box;}
html,body{
    margin:0;
    padding:0;
    height:100%;
    background:var(--bg-main);
    color:var(--text-main);
    font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    scroll-behavior:smooth;
}
body{overflow:hidden;}

/* Layout */
.app-wrapper{height:100vh;}
.sidebar{
    background:radial-gradient(circle at top left,#0f172a,var(--bg-sidebar));
    border-right:1px solid var(--border-subtle);
    height:100vh;
    position:sticky;top:0;
    overflow-y:auto;
    padding:1.2rem 1rem;
}
.content-panel{
    height:100vh;
    overflow-y:auto;
    padding:1.5rem 2rem;
    background:radial-gradient(circle at top right,#020617,var(--bg-main));
}

/* Scrollbars */
.sidebar::-webkit-scrollbar,
.content-panel::-webkit-scrollbar{width:8px;}
.sidebar::-webkit-scrollbar-thumb,
.content-panel::-webkit-scrollbar-thumb{
    background:#1f2937;border-radius:999px;
}

/* Sidebar text */
.course-tag{
    font-size:0.75rem;
    letter-spacing:0.14em;
    text-transform:uppercase;
    color:var(--accent-amber);
}
.main-title{
    font-size:1.4rem;
    font-weight:700;
    color:var(--accent-cyan);
}
.subtitle{
    font-size:0.9rem;
    color:var(--text-muted);
}
.meta-text{
    font-size:0.8rem;
    color:var(--text-muted);
}
.pill{
    display:inline-flex;
    align-items:center;
    border-radius:999px;
    padding:0.15rem 0.55rem;
    font-size:0.72rem;
    border:1px solid rgba(148,163,184,0.6);
    color:var(--text-muted);
    margin:0.15rem 0.25rem 0.15rem 0;
}
.pill span.bullet{
    width:6px;height:6px;border-radius:999px;
    background:var(--accent-cyan);
    margin-right:0.25rem;
}

/* TOC */
.toc-card{
    margin-top:1rem;
    background:rgba(15,23,42,0.95);
    border-radius:0.75rem;
    border:1px solid rgba(148,163,184,0.3);
    padding:0.9rem;
}
.toc-title{
    font-size:0.9rem;
    font-weight:600;
    color:var(--accent-amber);
}
.toc-search input{
    width:100%;
    border-radius:999px;
    border:1px solid #111827;
    background:#020617;
    color:var(--text-main);
    font-size:0.78rem;
    padding:0.2rem 0.6rem;
}
.toc-list{
    list-style:none;
    padding-left:0;
    margin:0.4rem 0 0 0;
}
.toc-link{
    display:flex;
    align-items:center;
    gap:0.4rem;
    font-size:0.8rem;
    padding:0.18rem 0.4rem;
    border-radius:0.4rem;
    text-decoration:none;
    color:var(--text-muted);
}
.toc-link-dot{
    width:6px;height:6px;border-radius:999px;
    background:rgba(148,163,184,0.7);
}
.toc-link:hover{
    background:rgba(15,23,42,0.9);
    color:var(--accent-cyan);
}
.toc-link.active{
    background:rgba(8,47,73,0.85);
    color:var(--accent-cyan);
}
.toc-link.active .toc-link-dot{background:var(--accent-cyan);}
.toc-actions button{
    border-radius:999px;
    border:1px solid rgba(148,163,184,0.45);
    background:rgba(15,23,42,0.9);
    color:var(--text-muted);
    font-size:0.72rem;
    padding:0.12rem 0.6rem;
}

/* Content */
.content-heading h1{
    font-size:1.6rem;
    color:var(--accent-cyan);
}
.content-heading p{
    font-size:0.9rem;
    color:var(--text-muted);
}
.badge-level,.badge-topic{
    font-size:0.75rem;
    border-radius:999px;
    padding:0.12rem 0.6rem;
}
.badge-level{
    border:1px solid rgba(56,189,248,0.6);
    color:var(--accent-cyan);
}
.badge-topic{
    border:1px dashed rgba(251,191,36,0.6);
    color:var(--accent-amber);
}
.summary-strip{
    background:radial-gradient(circle at left,rgba(56,189,248,0.2),transparent);
    border-radius:0.8rem;
    border:1px solid rgba(148,163,184,0.5);
    padding:0.8rem 1rem;
    font-size:0.86rem;
    margin-bottom:1.1rem;
}
.summary-strip strong{color:var(--accent-amber);}
.section-label{
    font-size:0.7rem;
    text-transform:uppercase;
    letter-spacing:0.16em;
    color:#9ca3af;
}
.section-title{
    font-size:1.05rem;
    font-weight:600;
    color:var(--accent-amber);
}
.section-subtitle{
    font-size:0.85rem;
    color:var(--text-muted);
    margin-bottom:0.6rem;
}

/* Details blocks */
details{
    background:rgba(15,23,42,0.9);
    border-radius:0.8rem;
    border:1px solid rgba(30,64,175,0.8);
    padding:0.25rem 0.85rem 0.6rem;
    margin-bottom:0.8rem;
}
details[open]{border-color:rgba(56,189,248,0.85);}
summary{
    list-style:none;
    cursor:pointer;
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:0.35rem 0;
    font-size:0.92rem;
    font-weight:600;
}
summary::-webkit-details-marker{display:none;}
.summary-label{display:flex;align-items:center;gap:0.4rem;}
.summary-label .dot{
    width:7px;height:7px;border-radius:999px;
    background:var(--accent-cyan);
}
.summary-tag{
    font-size:0.75rem;
    color:var(--accent-amber);
}
details .inner{
    font-size:0.84rem;
    color:var(--text-muted);
}
details .inner ul{padding-left:1.1rem;}
details .inner li{margin-bottom:0.2rem;}
.hint{
    border-left:3px solid var(--accent-cyan);
    padding-left:0.6rem;
    margin:0.4rem 0;
    font-size:0.8rem;
}

/* Code */
pre{
    background:var(--code-bg);
    border-radius:0.7rem;
    border:1px solid rgba(15,118,110,0.7);
    padding:0.7rem 0.9rem;
    overflow-x:auto;
    margin:0.4rem 0;
}
code{
    font-family:"JetBrains Mono","Fira Code",ui-monospace,monospace;
    font-size:0.8rem;
}
.token-comment{color:#6b7280;font-style:italic;}
.token-string{color:#fb923c;}
.token-number{color:#a855f7;}
.token-keyword{color:#22c55e;font-weight:600;}
.token-builtins{color:#facc15;}
.token-function{color:#38bdf8;}

/* Responsive */
@media (max-width:991.98px){
    body{overflow:auto;}
    .app-wrapper{height:auto;}
    .sidebar{
        height:auto;
        position:static;
        border-right:none;
        border-bottom:1px solid var(--border-subtle);
    }
    .content-panel{height:auto;}
}
</style>
</head>

<body>
<div class="container-fluid app-wrapper">
  <div class="row flex-nowrap">
    <!-- SIDEBAR -->
    <aside class="col-12 col-md-4 col-lg-3 sidebar">
      <div>
        <div class="course-tag">Modern JavaScript Deep Dive</div>
        <div class="main-title">13.1 – Prototype Chain</div>
        <div class="subtitle">How objects link, share and resolve properties</div>
        <div class="meta-text">
          Prepared for: College → Master / PhD level<br>
          Focus: Deep mental model &amp; practical debugging
        </div>
      </div>

      <div class="mt-2">
        <span class="pill"><span class="bullet"></span><code>__proto__</code></span>
        <span class="pill"><span class="bullet"></span>Object.prototype</span>
        <span class="pill"><span class="bullet"></span>Prototype chain</span>
        <span class="pill"><span class="bullet"></span>Lookup rules</span>
        <span class="pill"><span class="bullet"></span><code>hasOwnProperty</code></span>
      </div>

      <div class="toc-card mt-2">
        <div class="toc-title mb-1">On this page</div>
        <div class="mb-2">
          <input id="tocSearch" type="text" placeholder="Search sections…">
        </div>
        <ul id="tocList" class="toc-list">
          <li data-label="understanding proto">
            <a href="#sec-proto" class="toc-link">
              <span class="toc-link-dot"></span>
              <span>13.1.1 Understanding __proto__ / [[Prototype]]</span>
            </a>
          </li>
          <li data-label="object prototype">
            <a href="#sec-object-prototype" class="toc-link">
              <span class="toc-link-dot"></span>
              <span>13.1.2 Object.prototype</span>
            </a>
          </li>
          <li data-label="prototype chain traversal">
            <a href="#sec-chain" class="toc-link">
              <span class="toc-link-dot"></span>
              <span>13.1.3 Prototype chain traversal</span>
            </a>
          </li>
          <li data-label="property lookup mechanism">
            <a href="#sec-lookup" class="toc-link">
              <span class="toc-link-dot"></span>
              <span>13.1.4 Property lookup mechanism</span>
            </a>
          </li>
          <li data-label="hasOwnProperty vs in operator">
            <a href="#sec-hasown" class="toc-link">
              <span class="toc-link-dot"></span>
              <span>13.1.5 hasOwnProperty() vs in operator</span>
            </a>
          </li>
        </ul>
        <div class="toc-actions mt-2">
          <button id="btnExpandAll" type="button">Expand all</button>
          <button id="btnCollapseAll" type="button">Collapse all</button>
        </div>
      </div>
    </aside>

    <!-- CONTENT -->
    <main class="col content-panel">
      <section class="content-heading">
        <div class="d-flex flex-wrap align-items-center mb-2">
          <span class="badge-level">Level: Intermediate → Advanced</span>
          <span class="badge-topic ms-1">Topic: Prototype chain &amp; lookup</span>
        </div>
        <h1>13.1 – Prototype Chain in JavaScript</h1>
        <p>
          Every JavaScript object has an internal link to another object called its
          <strong>prototype</strong>. This forms a chain used for property lookup and method sharing.
          ES6 classes, constructor functions, object literals – all ultimately rely on the
          <strong>prototype chain</strong>. Understanding it is the key to mastering inheritance,
          performance, and debugging “why is this property visible here?” questions.
        </p>
      </section>

      <section>
        <div class="summary-strip">
          <strong>Executive intuition:</strong>
          Think of each object as a node in a linked list. If JavaScript cannot find a property on the
          current object, it walks one step “up” to the prototype, then that object’s prototype, and so
          on, until it reaches <code>Object.prototype</code> or <code>null</code>. This walk is the
          <em>prototype chain</em>, and it is the core of JavaScript’s delegation model.
        </div>
      </section>

      <!-- 13.1.1 – Understanding __proto__ -->
      <section id="sec-proto" class="mb-4">
        <div class="section-label">13.1.1</div>
        <div class="section-title">Understanding <code>__proto__</code> / [[Prototype]]</div>
        <div class="section-subtitle">The hidden link that connects objects.</div>

        <details open>
          <summary>
            <span class="summary-label"><span class="dot"></span>[[Prototype]] vs <code>__proto__</code> vs prototype</span>
            <span class="summary-tag">concept</span>
          </summary>
          <div class="inner">
            <ul>
              <li><strong>[[Prototype]]</strong> is the internal slot – the real engine-level pointer.</li>
              <li><strong><code>__proto__</code></strong> is a legacy accessor property on some objects that lets you get/set [[Prototype]].</li>
              <li><strong><code>Function.prototype.prototype</code></strong> is a normal property on constructor functions used to set the prototype for instances created with <code>new</code>.</li>
            </ul>

            <pre><code>
const obj = { a: 1 };
const proto = { b: 2 };

Object.setPrototypeOf(obj, proto);   // sets [[Prototype]]
console.log(obj.b);                  // 2, from proto

console.log(Object.getPrototypeOf(obj) === proto); // true
// In many environments:
console.log(obj.__proto__ === proto); // true (but prefer getPrototypeOf/setPrototypeOf)
            </code></pre>

            <p class="hint">
              Best practice: prefer <code>Object.getPrototypeOf</code> / <code>Object.setPrototypeOf</code>
              or <code>Object.create</code> instead of direct <code>__proto__</code>, which is mostly kept for compatibility.
            </p>
          </div>
        </details>

        <details>
          <summary>
            <span class="summary-label"><span class="dot"></span>Creating objects with a specific prototype</span>
            <span class="summary-tag">syntax</span>
          </summary>
          <div class="inner">
            <pre><code>
// Object literal - prototype is Object.prototype
const o1 = { x: 1 };

// Create with explicit prototype
const animal = { eats: true };
const dog = Object.create(animal);
dog.barks = true;

console.log(dog.eats); // true (from prototype)
console.log(Object.getPrototypeOf(dog) === animal); // true
            </code></pre>
          </div>
        </details>
      </section>

      <!-- 13.1.2 – Object.prototype -->
      <section id="sec-object-prototype" class="mb-4">
        <div class="section-label">13.1.2</div>
        <div class="section-title"><code>Object.prototype</code></div>
        <div class="section-subtitle">The root of most prototype chains.</div>

        <details open>
          <summary>
            <span class="summary-label"><span class="dot"></span>What lives on Object.prototype</span>
            <span class="summary-tag">root</span>
          </summary>
          <div class="inner">
            <p>
              For “normal” objects (created via literals, <code>new Object()</code>, classes, etc.),
              the top of the chain is <code>Object.prototype</code>. It holds methods like:
            </p>
            <ul>
              <li><code>toString()</code></li>
              <li><code>hasOwnProperty()</code></li>
              <li><code>valueOf()</code></li>
              <li><code>isPrototypeOf()</code></li>
            </ul>

            <pre><code>
const obj = { a: 1 };

console.log(Object.getPrototypeOf(obj) === Object.prototype); // true
console.log(obj.toString === Object.prototype.toString);      // true
console.log(obj.hasOwnProperty("a"));                         // true
            </code></pre>
          </div>
        </details>

        <details>
          <summary>
            <span class="summary-label"><span class="dot"></span>Objects without Object.prototype</span>
            <span class="summary-tag">edge case</span>
          </summary>
          <div class="inner">
            <p>
              You can deliberately create an object with <code>null</code> prototype. Useful for
              pure key/value dictionaries where you don’t want inherited properties.
            </p>

            <pre><code>
const dict = Object.create(null);
dict.x = 1;

console.log(Object.getPrototypeOf(dict)); // null
console.log(dict.toString);               // undefined (no Object.prototype)
            </code></pre>

            <p class="hint">
              This avoids collisions with keys like <code>"toString"</code> or <code>"hasOwnProperty"</code>.
              Very common in security-sensitive or performance-critical code like compilers, linters, etc.
            </p>
          </div>
        </details>
      </section>

      <!-- 13.1.3 – Prototype chain traversal -->
      <section id="sec-chain" class="mb-4">
        <div class="section-label">13.1.3</div>
        <div class="section-title">Prototype chain traversal</div>
        <div class="section-subtitle">Visualizing the linked list of prototypes.</div>

        <details open>
          <summary>
            <span class="summary-label"><span class="dot"></span>Simple chain example</span>
            <span class="summary-tag">example</span>
          </summary>
          <div class="inner">
            <pre><code>
const grandparent = { gp: "grandparent" };
const parent = Object.create(grandparent);
parent.p = "parent";

const child = Object.create(parent);
child.c = "child";

console.log(child.c);  // "child" (own)
console.log(child.p);  // "parent" (from parent)
console.log(child.gp); // "grandparent" (from grandparent)
            </code></pre>

            <p>
              Chain (from <code>child</code> upwards):
            </p>
            <pre><code>
child --[[Prototype]]--&gt; parent --[[Prototype]]--&gt; grandparent --[[Prototype]]--&gt; Object.prototype --[[Prototype]]--&gt; null
            </code></pre>
          </div>
        </details>

        <details>
          <summary>
            <span class="summary-label"><span class="dot"></span>Inspecting the chain programmatically</span>
            <span class="summary-tag">tooling</span>
          </summary>
          <div class="inner">
            <pre><code>
function showPrototypeChain(obj) {
    const chain = [];
    let current = obj;
    while (current !== null) {
        chain.push(current);
        current = Object.getPrototypeOf(current);
    }
    return chain;
}

const chain = showPrototypeChain(child);
console.log(chain.length); // 4 or 5 depending on environment
            </code></pre>

            <p class="hint">
              In DevTools, you can also explore <code>__proto__</code> in the console, but for code
              use <code>Object.getPrototypeOf</code>.
            </p>
          </div>
        </details>
      </section>

      <!-- 13.1.4 – Property lookup mechanism -->
      <section id="sec-lookup" class="mb-4">
        <div class="section-label">13.1.4</div>
        <div class="section-title">Property lookup mechanism</div>
        <div class="section-subtitle">Exactly how JavaScript finds (or fails to find) a property.</div>

        <details open>
          <summary>
            <span class="summary-label"><span class="dot"></span>Lookup algorithm (conceptual)</span>
            <span class="summary-tag">mechanism</span>
          </summary>
          <div class="inner">
            <p>
              When you access <code>obj.prop</code>, the engine does roughly:
            </p>
            <ol>
              <li>Check if <code>obj</code> has own property <code>"prop"</code>. If yes → return it.</li>
              <li>Else, let <code>parent = Object.getPrototypeOf(obj)</code>.</li>
              <li>If <code>parent</code> is <code>null</code> → return <code>undefined</code>.</li>
              <li>Else, repeat process for <code>parent</code>.</li>
            </ol>

            <pre><code>
const proto = { shared: 42 };
const obj = Object.create(proto);
obj.own = 10;

console.log(obj.own);    // 10 (found on obj)
console.log(obj.shared); // 42 (found on proto)
console.log(obj.missing); // undefined (not found)
            </code></pre>
          </div>
        </details>

        <details>
          <summary>
            <span class="summary-label"><span class="dot"></span>Shadowing: own property hides prototype property</span>
            <span class="summary-tag">shadowing</span>
          </summary>
          <div class="inner">
            <pre><code>
const base = { x: 1 };
const obj = Object.create(base);

console.log(obj.x); // 1 from prototype

obj.x = 99;         // creates own property 'x'
console.log(obj.x); // 99 (own)
console.log(base.x); // 1 (unchanged)
            </code></pre>

            <p class="hint">
              This is called <strong>shadowing</strong>. The own property shadows the one on the prototype.
            </p>
          </div>
        </details>

        <details>
          <summary>
            <span class="summary-label"><span class="dot"></span>Lookup and performance considerations</span>
            <span class="summary-tag">perf</span>
          </summary>
          <div class="inner">
            <p>
              Conceptually, each step up the chain adds cost. Engines optimize heavily, but extremely deep chains or
              constantly mutating prototypes can hurt performance.
            </p>
            <ul>
              <li>Keep prototype chains relatively shallow.</li>
              <li>Avoid changing prototypes after many instances are created.</li>
              <li>Prefer stable shapes (same property layout) for objects created in loops.</li>
            </ul>
          </div>
        </details>
      </section>

      <!-- 13.1.5 – hasOwnProperty vs in -->
      <section id="sec-hasown" class="mb-4">
        <div class="section-label">13.1.5</div>
        <div class="section-title"><code>hasOwnProperty()</code> vs <code>in</code> operator</div>
        <div class="section-subtitle">Checking for properties the correct way.</div>

        <details open>
          <summary>
            <span class="summary-label"><span class="dot"></span>Difference in behaviour</span>
            <span class="summary-tag">comparison</span>
          </summary>
          <div class="inner">
            <ul>
              <li><code>obj.hasOwnProperty("prop")</code> → only checks own properties on <code>obj</code> itself.</li>
              <li><code>"prop" in obj</code> → checks <em>anywhere</em> on the prototype chain.</li>
            </ul>

            <pre><code>
const proto = { inherited: 1 };
const obj = Object.create(proto);
obj.own = 2;

console.log(obj.hasOwnProperty("own"));       // true
console.log(obj.hasOwnProperty("inherited")); // false

console.log("own" in obj);        // true
console.log("inherited" in obj);  // true (found on prototype)
console.log("missing" in obj);    // false
            </code></pre>
          </div>
        </details>

        <details>
          <summary>
            <span class="summary-label"><span class="dot"></span>Safe use of hasOwnProperty</span>
            <span class="summary-tag">best practice</span>
          </summary>
          <div class="inner">
            <p>
              Since an object might override <code>hasOwnProperty</code>, robust code prefers calling it
              from <code>Object.prototype</code>:
            </p>

            <pre><code>
const dict = Object.create(null);
dict.x = 1;

// dict.hasOwnProperty is undefined here
console.log(Object.prototype.hasOwnProperty.call(dict, "x")); // true
            </code></pre>

            <p class="hint">
              Pattern: <code>Object.prototype.hasOwnProperty.call(obj, key)</code> is safest for
              working with arbitrary objects or dictionaries.
            </p>
          </div>
        </details>

        <details>
          <summary>
            <span class="summary-label"><span class="dot"></span>When to use which</span>
            <span class="summary-tag">guidance</span>
          </summary>
          <div class="inner">
            <ul>
              <li>
                Use <code>hasOwnProperty</code> when you care only about an object’s own properties (e.g., when serializing,
                validating payloads, iterating through user data).
              </li>
              <li>
                Use <code>"prop" in obj</code> when you care if the property is available for use, regardless of whether it is
                inherited (e.g., when checking if a method or feature exists).
              </li>
            </ul>
          </div>
        </details>
      </section>
    </main>
  </div>
</div>

<script>
// Smooth scrolling + active TOC + search + expand/collapse + simple highlighting
document.addEventListener("DOMContentLoaded", () => {
  const contentPanel = document.querySelector(".content-panel");
  const tocLinks = Array.from(document.querySelectorAll(".toc-link"));
  const sections = tocLinks.map(link => {
    const id = link.getAttribute("href");
    return { link, target: document.querySelector(id) };
  });

  // Smooth scroll
  tocLinks.forEach(link => {
    link.addEventListener("click", e => {
      e.preventDefault();
      const id = link.getAttribute("href");
      const target = document.querySelector(id);
      if (target) {
        target.scrollIntoView({ behavior: "smooth", block: "start" });
        history.replaceState(null, "", id);
      }
    });
  });

  // Active TOC highlight
  function updateActive() {
    const y = contentPanel.scrollTop;
    let current = null;
    sections.forEach(({ link, target }) => {
      if (!target) return;
      const top = target.offsetTop;
      if (top - 80 <= y) current = link;
    });
    tocLinks.forEach(l => l.classList.remove("active"));
    if (current) current.classList.add("active");
  }
  contentPanel.addEventListener("scroll", updateActive);
  updateActive();

  // TOC search
  const tocSearch = document.getElementById("tocSearch");
  const tocItems = Array.from(document.querySelectorAll("#tocList li"));
  tocSearch.addEventListener("input", () => {
    const q = tocSearch.value.toLowerCase();
    tocItems.forEach(li => {
      const text = li.textContent.toLowerCase() || "";
      li.style.display = text.includes(q) ? "" : "none";
    });
  });

  // Expand / collapse all
  document.getElementById("btnExpandAll").onclick =
    () => document.querySelectorAll("details").forEach(d => d.open = true);
  document.getElementById("btnCollapseAll").onclick =
    () => document.querySelectorAll("details").forEach(d => d.open = false);

  // Simple syntax highlighting
  function escapeHtml(str){
    return str.replace(/&/g,"&amp;")
              .replace(/</g,"&lt;")
              .replace(/>/g,"&gt;");
  }
  const keywords = [
    "class","extends","constructor","super",
    "function","return","const","let","var",
    "if","else","while","for","new","async","await",
    "try","catch","throw","in"
  ];
  const builtins = [
    "Object","Array","Map","Set","Date","Promise",
    "console","Math","JSON","fetch"
  ];

  document.querySelectorAll("pre code").forEach(codeEl => {
    const raw = codeEl.textContent;
    let html = escapeHtml(raw);

    // comments
    html = html.replace(/(\/\/.*?$)/gm,"<span class='token-comment'>$1</span>");
    // strings
    html = html.replace(/(&quot;.*?&quot;|'.*?'|`.*?`)/g,
      "<span class='token-string'>$1</span>");
    // numbers
    html = html.replace(/\b(\d+(\.\d+)?)\b/g,
      "<span class='token-number'>$1</span>");
    // builtins
    builtins.forEach(b => {
      const re = new RegExp("\\b"+b+"\\b","g");
      html = html.replace(re,"<span class='token-builtins'>"+b+"</span>");
    });
    // keywords
    keywords.forEach(k => {
      const re = new RegExp("\\b"+k+"\\b","g");
      html = html.replace(re,"<span class='token-keyword'>"+k+"</span>");
    });
    // functions (simple heuristic)
    html = html.replace(/([a-zA-Z_$][\w$]*)\s*(?=\()/g,
      "<span class='token-function'>$1</span>");

    codeEl.innerHTML = html;
  });
});
</script>
</body>
</html>
