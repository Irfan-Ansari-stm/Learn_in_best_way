<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>27.3 Modern Backend Frameworks — Deep Learning Note</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <!-- Highlight.js CSS (dark friendly) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">

  <style>
    :root{
      --bg:#0b0f11;
      --surface:#0f1416;
      --muted:#94a3b8;
      --accent-cyan:#06b6d4;
      --accent-amber:#ffb020;
      --text:#e6eef6;
      --heading:#bfefff;
      --panel-width:320px;
      --radius:12px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Courier New", monospace;
    }
    html,body{height:100%;background:var(--bg);color:var(--text);font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;margin:0;padding:0;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}
    .app { display:flex; height:100vh; gap:18px; padding:18px; box-sizing:border-box; }
    .left-panel { width:var(--panel-width); min-width:var(--panel-width); max-width:var(--panel-width); background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.03)); border-radius:var(--radius); padding:16px; box-shadow:0 8px 30px rgba(2,6,23,0.6); display:flex; flex-direction:column; gap:12px; }
    .brand { display:flex; gap:10px; align-items:center; }
    .logo { height:44px; width:44px; border-radius:8px; background:linear-gradient(135deg,var(--accent-cyan),var(--accent-amber)); display:flex; align-items:center; justify-content:center; font-weight:700; color:#021014; box-shadow:0 6px 18px rgba(4,6,8,0.6); }
    .title { font-weight:700; color:var(--heading); font-size:0.95rem; }
    .subtitle{ font-size:0.78rem; color:var(--muted); margin-top:-4px; }
    .toc-search { display:flex; gap:8px; align-items:center; margin-top:4px; }
    .toc-search input{ flex:1; background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--text); padding:8px 10px; border-radius:8px; outline:none; }
    .controls { display:flex; gap:8px; }
    .toc { overflow:auto; padding-right:6px; }
    .toc a { display:block; color:var(--muted); text-decoration:none; padding:6px 8px; border-radius:6px; font-size:0.92rem; }
    .toc a:hover, .toc a.active { background:rgba(6,182,212,0.08); color:var(--accent-cyan); }
    .right-panel { flex:1; background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00)); border-radius:var(--radius); padding:24px; overflow:auto; scroll-behavior:smooth; box-shadow:0 8px 40px rgba(2,6,23,0.6); }
    .content h1, .content h2, .content h3 { color:var(--heading); }
    .meta { display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-bottom:8px; }
    .badge-accent { background: linear-gradient(90deg,var(--accent-cyan),var(--accent-amber)); color:#021014; padding:6px 10px; border-radius:999px; font-weight:700; font-size:0.82rem; }
    p.lead { color:var(--muted); margin-bottom:18px; line-height:1.6; }
    details { background: rgba(255,255,255,0.01); border:1px solid rgba(255,255,255,0.03); padding:12px 14px; margin-bottom:12px; border-radius:10px; }
    summary { cursor:pointer; font-weight:700; color:var(--accent-cyan); outline:none; list-style:none; }
    summary::-webkit-details-marker { display:none; }
    details[open] summary { color:var(--accent-amber); }
    .subsection { margin-top:10px; color:var(--muted); }
    pre { background: #071014; border:1px solid rgba(255,255,255,0.03); padding:14px; border-radius:8px; overflow:auto; font-family: var(--mono); font-size:0.95rem; line-height:1.45; }
    code { font-family:var(--mono); font-size:0.92rem; }
    .small-muted { color:var(--muted); font-size:0.9rem; }
    @media (max-width:900px){ .app { flex-direction:column; padding:12px; } .left-panel { width:100%; min-width:auto; max-width:100%; order:2; } .right-panel { order:1; height:60vh; } }
  </style>
</head>
<body>
  <div class="app container-fluid">
    <!-- LEFT PANEL -->
    <aside class="left-panel" aria-label="Table of contents">
      <div class="brand">
        <div class="logo">F</div>
        <div>
          <div class="title">27.3 Modern Backend Frameworks</div>
          <div class="subtitle small-muted">Express • Fastify • NestJS • Serverless • GraphQL</div>
        </div>
      </div>

      <div class="meta small-muted">
        <div>Author: <strong>DeepTutor</strong></div>
        <div>Level: <strong>College → PhD</strong></div>
        <div class="badge-accent">Backend • Node.js • JS</div>
      </div>

      <div class="toc-search">
        <input id="tocFilter" type="search" placeholder="Search TOC..." aria-label="Search table of contents" />
        <div class="controls">
          <button id="expandAllBtn" class="btn btn-sm btn-outline-light" title="Expand all sections">Expand</button>
          <button id="collapseAllBtn" class="btn btn-sm btn-outline-light" title="Collapse all sections">Collapse</button>
        </div>
      </div>

      <nav class="toc" id="tocList" tabindex="0" aria-label="Contents list">
        <a href="#express" data-filter="express">Express.js fundamentals</a>
        <a href="#fastify" data-filter="fastify">Fastify for performance</a>
        <a href="#nestjs" data-filter="nestjs">NestJS for enterprise apps</a>
        <a href="#serverless" data-filter="serverless">Serverless functions</a>
        <a href="#graphql" data-filter="graphql">GraphQL server implementation</a>
        <a href="#cheatsheet" data-filter="cheatsheet">Cheat-sheet</a>
      </nav>

      <div style="margin-top:auto; font-size:0.8rem; color:var(--muted);">
        <div>Tips:</div>
        <ul style="padding-left:16px; margin:6px 0;">
          <li>Run examples with Node &gt;= 14; prefer Node 18+ for modern features.</li>
          <li>Use the search box to find sections quickly.</li>
          <li>Expand all for full reading or collapse for skimming.</li>
        </ul>
      </div>
    </aside>

    <!-- RIGHT PANEL -->
    <main class="right-panel" role="main">
      <article class="content">
        <h1>27.3 Modern Backend Frameworks</h1>
        <p class="lead">This learning note explores the most-used modern backend frameworks and patterns in Node.js: <strong>Express.js</strong>, <strong>Fastify</strong>, <strong>NestJS</strong>, serverless functions, and building a GraphQL server. Each subsection is layered with an executive summary, deep internals, clear syntax examples, and production notes.</p>
        <hr style="border-color: rgba(255,255,255,0.03); margin-bottom:20px;">

        <!-- Express -->
        <section id="express">
          <h2>Express.js fundamentals</h2>

          <details open>
            <summary>Executive summary</summary>
            <div class="subsection">Express provides a minimal, unopinionated web framework with routing, middleware, and a vast ecosystem of middleware packages. It's the standard go-to for quick backend development, prototyping, and many production APIs.</div>
          </details>

          <details>
            <summary>Deep details (architecture & middleware model)</summary>
            <div class="subsection">
              <ol>
                <li><strong>Middleware chain:</strong> Express uses a linear middleware chain: <code>app.use()</code> registers functions that receive <code>(req, res, next)</code>. Middleware may end the response or call <code>next()</code> to pass to the next function.</li>
                <li><strong>Routing:</strong> Routes are matched in registration order. Parameters (<code>/:id</code>) and regex routes are supported. Prioritize specific routes before generic ones.</li>
                <li><strong>Error handling:</strong> Error middleware has four args <code>(err, req, res, next)</code>. Always have a centralized handler for consistent responses.</li>
                <li><strong>Extensibility:</strong> Massive ecosystem (helmet, cors, multer, rate-limiters). Express focuses on composition, not rigid structure.</li>
                <li><strong>Performance notes:</strong> Express is synchronous in middleware, so heavy work should be async or offloaded.</li>
              </ol>
            </div>
          </details>

          <details>
            <summary>Syntax & tiny reference</summary>
            <div class="subsection">
              <pre><code class="language-js">// Express minimal app with middleware & error handler
const express = require('express');
const app = express();

app.use(express.json()); // parse JSON

// simple middleware
app.use((req, res, next) =&gt; {
  req.start = Date.now();
  next();
});

app.get('/ping', (req, res) =&gt; {
  res.json({ pong: true, took: Date.now() - req.start });
});

// error handler
app.use((err, req, res, next) =&gt; {
  console.error(err);
  res.status(err.status || 500).json({ error: err.message || 'Internal Server Error' });
});

app.listen(3000, () =&gt; console.log('Express running on 3000'));</code></pre>
            </div>
          </details>

          <details>
            <summary>Example (clean route module pattern)</summary>
            <div class="subsection">
              <pre><code class="language-js">// server.js
const express = require('express');
const app = express();
app.use(express.json());
app.use('/users', require('./routes/users'));
app.listen(3000);

// routes/users.js
const express = require('express');
const router = express.Router();

router.get('/:id', async (req, res, next) =&gt; {
  try {
    const user = await findUser(req.params.id); // DB call
    if (!user) return res.status(404).json({ error: 'Not found' });
    res.json(user);
  } catch (err) { next(err); }
});

module.exports = router;</code></pre>
              <p class="small-muted">Pattern: keep routes modular, attach shared middleware at app-level (auth, logging), and use dependency injection for testability.</p>
            </div>
          </details>

          <details>
            <summary>Production notes</summary>
            <div class="subsection">
              <ul>
                <li>Use <code>helmet</code>, <code>cors</code>, body size limits, rate-limiting, and monitoring.</li>
                <li>Prefer clustering (PM2, cluster module) or run multiple instances behind load balancer for multi-core scaling.</li>
                <li>Consider Fastify for high-throughput services — migrate only when needed.</li>
              </ul>
            </div>
          </details>
        </section>

        <hr style="border-color: rgba(255,255,255,0.03); margin:20px 0;">

        <!-- Fastify -->
        <section id="fastify">
          <h2>Fastify for performance</h2>

          <details open>
            <summary>Executive summary</summary>
            <div class="subsection">Fastify is a modern, high-performance web framework for Node.js that emphasizes low overhead, schema-based validation, and JSON serialization optimizations. Use it when throughput and low latency matter.</div>
          </details>

          <details>
            <summary>Deep details (why fast & schema benefits)</summary>
            <div class="subsection">
              <ol>
                <li><strong>Schema-based routes:</strong> Fastify uses JSON schema for input/response which enables fast validation and optimized serialization.</li>
                <li><strong>Plugin architecture:</strong> Encapsulate features in plugins; Fastify has a lifecycle that isolates scope and avoids global mutations.</li>
                <li><strong>Low overhead:</strong> Internal optimizations (fast JSON serializer) and less middleware chaining overhead improve throughput.</li>
                <li><strong>Testing & types:</strong> Good TypeScript support and clear plugin boundaries improve developer experience for large services.</li>
              </ol>
            </div>
          </details>

          <details>
            <summary>Syntax & tiny reference</summary>
            <div class="subsection">
              <pre><code class="language-js">// Fastify minimal server with JSON schema
const fastify = require('fastify')({ logger: true });

fastify.get('/ping', {
  schema: {
    response: {
      200: {
        type: 'object',
        properties: { pong: { type: 'boolean' } }
      }
    }
  }
}, async (request, reply) =&gt; {
  return { pong: true };
});

fastify.listen({ port: 3000 }).then(() =&gt; console.log('Fastify listening on 3000'));</code></pre>
            </div>
          </details>

          <details>
            <summary>Example (plugin + encapsulation)</summary>
            <div class="subsection">
              <pre><code class="language-js">// plugin example
// plugins/db.js
async function dbPlugin (fastify, opts) {
  const pool = createPool(opts.connString);
  fastify.decorate('db', pool);
  fastify.addHook('onClose', async (instance) =&gt; { await pool.end(); });
}
module.exports = dbPlugin;

// server.js
const fastify = require('fastify')();
fastify.register(require('./plugins/db'), { connString: process.env.DATABASE_URL });

fastify.get('/users/:id', async (req, reply) =&gt; {
  const res = await fastify.db.query('SELECT id, name FROM users WHERE id=$1', [req.params.id]);
  if (!res.rows.length) return reply.code(404).send({ error: 'Not found' });
  return res.rows[0];
});

fastify.listen(3000);</code></pre>
              <p class="small-muted">Plugins keep resources scoped; fastify.decorate exposes them safely without polluting globals.</p>
            </div>
          </details>

          <details>
            <summary>Performance tuning & notes</summary>
            <div class="subsection">
              <ul>
                <li>Use schema validation and response schema for fastest serialization.</li>
                <li>Avoid heavy synchronous tasks in handlers; use worker threads if necessary.</li>
                <li>Benchmark (autocannon) before choosing — Fastify often outperforms Express in raw throughput.</li>
              </ul>
            </div>
          </details>
        </section>

        <hr style="border-color: rgba(255,255,255,0.03); margin:20px 0;">

        <!-- NestJS -->
        <section id="nestjs">
          <h2>NestJS for enterprise applications</h2>

          <details open>
            <summary>Executive summary</summary>
            <div class="subsection">NestJS is an opinionated framework built on top of Node and Express/Fastify, inspired by Angular. It offers dependency-injection, modular architecture, decorators, and TypeScript-first development — ideal for large, maintainable codebases.</div>
          </details>

          <details>
            <summary>Deep details (architecture & DI)</summary>
            <div class="subsection">
              <ol>
                <li><strong>Modules</strong>: Encapsulate features; modules export providers for reuse.</li>
                <li><strong>Dependency Injection (DI)</strong>: Services/providers are injected into controllers, enabling testable and decoupled code.</li>
                <li><strong>Decorators & metadata</strong>: Use decorators (@Controller, @Injectable, @Module) to declare intent; Nest translates metadata to runtime behavior.</li>
                <li><strong>Adapters</strong>: Swap underlying HTTP adapter (Express or Fastify) for performance or features.</li>
                <li><strong>Testing & CLI</strong>: Nest CLI scaffolds modules and provides testing utilities; strong TypeScript support yields better DX for enterprise teams.</li>
              </ol>
            </div>
          </details>

          <details>
            <summary>Syntax & tiny reference (TypeScript flavor but JS-compatible patterns)</summary>
            <div class="subsection">
              <pre><code class="language-ts">// NestJS-style (TypeScript) example (JS equivalent exists)
// users.controller.ts
import { Controller, Get, Param } from '@nestjs/common';
import { UsersService } from './users.service';

@Controller('users')
export class UsersController {
  constructor(private readonly usersService: UsersService) {}
  @Get(':id')
  async getById(@Param('id') id: string) {
    return this.usersService.findById(id);
  }
}</code></pre>
              <p class="small-muted">In pure JS projects you can still use Nest by compiling TS to JS; Nest strongly encourages TypeScript for typing and DI metadata.</p>
            </div>
          </details>

          <details>
            <summary>Example (module & service pattern)</summary>
            <div class="subsection">
              <pre><code class="language-ts">// users.service.ts
import { Injectable } from '@nestjs/common';

@Injectable()
export class UsersService {
  async findById(id: string) {
    // DB call
    return { id, name: 'Zara' };
  }
}

// users.module.ts
import { Module } from '@nestjs/common';
import { UsersService } from './users.service';
import { UsersController } from './users.controller';

@Module({
  controllers: [UsersController],
  providers: [UsersService],
})
export class UsersModule {}</code></pre>
              <p class="small-muted">Nest is great when your product requires strong structure, teams, and long-term maintainability.</p>
            </div>
          </details>

          <details>
            <summary>When to choose NestJS</summary>
            <div class="subsection">
              <ul>
                <li>Large teams, enterprise projects, or when you want DI and strong structure out-of-the-box.</li>
                <li>Prefer Nest if you want opinionated conventions, integrated testing utilities, and decorators for declarative code.</li>
                <li>Be mindful: steeper learning curve than Express, more boilerplate for small projects.</li>
              </ul>
            </div>
          </details>
        </section>

        <hr style="border-color: rgba(255,255,255,0.03); margin:20px 0;">

        <!-- Serverless -->
        <section id="serverless">
          <h2>Serverless functions</h2>

          <details open>
            <summary>Executive summary</summary>
            <div class="subsection">Serverless functions (AWS Lambda, Azure Functions, Google Cloud Functions, Vercel, Netlify) let you run code without managing servers; they scale automatically, charge per invocation, and fit event-driven & HTTP use-cases.</div>
          </details>

          <details>
            <summary>Deep details (cold starts, packaging, best practices)</summary>
            <div class="subsection">
              <ol>
                <li><strong>Cold starts:</strong> First invocation may be slow due to runtime boot. Minimize by using smaller function bundles, warming strategies, or provisioned concurrency.</li>
                <li><strong>Packaging:</strong> Bundle only necessary dependencies; prefer native modules avoidance or provide prebuilt binaries.</li>
                <li><strong>Statelessness:</strong> Functions should be stateless; use external DBs, caches, and storage for stateful needs.</li>
                <li><strong>Timeouts & limits:</strong> Watch memory, timeout, and concurrency limits. Use retries and idempotency keys for uncertain networks.</li>
                <li><strong>Local development:</strong> Use tools like Serverless Framework, SAM, or local emulators for testing.</li>
              </ol>
            </div>
          </details>

          <details>
            <summary>Syntax & example (AWS Lambda, Node handler)</summary>
            <div class="subsection">
              <pre><code class="language-js">// AWS Lambda simple handler (API Gateway v2)
exports.handler = async (event) =&gt; {
  // event.body is a string if sent via API Gateway
  const payload = event.body ? JSON.parse(event.body) : {};
  // do work (DB, etc.)
  return {
    statusCode: 200,
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ message: 'ok', received: payload }),
  };
};</code></pre>
            </div>
          </details>

          <details>
            <summary>Example (serverless HTTP with Vercel / Netlify)</summary>
            <div class="subsection">
              <pre><code class="language-js">// Vercel / Netlify endpoint (Node)
module.exports = async (req, res) =&gt; {
  if (req.method !== 'POST') return res.status(405).send('Method Not Allowed');
  const payload = req.body;
  res.json({ ok: true, payload });
};</code></pre>
              <p class="small-muted">Vercel/Netlify assume single-file endpoints with minimal cold-start overhead; keep them tiny for best latency.</p>
            </div>
          </details>

          <details>
            <summary>Serverless patterns & tradeoffs</summary>
            <div class="subsection">
              <ul>
                <li>Great for spiky workloads, small microservices, and event-driven pipelines.</li>
                <li>Not ideal when low-latency persistent connections or complex long-lived transactions are required.</li>
                <li>Observe cost: high invocation volumes may be cheaper on always-on instances depending on usage patterns.</li>
              </ul>
            </div>
          </details>
        </section>

        <hr style="border-color: rgba(255,255,255,0.03); margin:20px 0;">

        <!-- GraphQL -->
        <section id="graphql">
          <h2>GraphQL server implementation</h2>

          <details open>
            <summary>Executive summary</summary>
            <div class="subsection">GraphQL provides a typed query language and runtime that lets clients request precisely the data they need. Use GraphQL for flexible client-driven APIs, but be mindful of complexity and caching tradeoffs compared to REST.</div>
          </details>

          <details>
            <summary>Deep details (schema, resolvers, dataloader)</summary>
            <div class="subsection">
              <ol>
                <li><strong>Schema-first:</strong> Define types and operations (Query, Mutation, Subscription). Schemas serve as contracts between client and server.</li>
                <li><strong>Resolvers:</strong> Functions that resolve fields; they can be fine-grained and cause N+1 issues if not optimized.</li>
                <li><strong>DataLoader:</strong> Batch and cache DB calls per request to avoid N+1 problems.</li>
                <li><strong>Performance:</strong> Query depth limiting, complexity analysis, and persisted queries help mitigate abuse and heavy queries.</li>
                <li><strong>Subscriptions:</strong> Use WebSockets or server push (GraphQL over WS) for real-time updates.</li>
              </ol>
            </div>
          </details>

          <details>
            <summary>Syntax & example (Apollo Server minimal)</summary>
            <div class="subsection">
              <pre><code class="language-js">// Apollo Server minimal example
const { ApolloServer, gql } = require('apollo-server');

const typeDefs = gql`
  type User { id: ID!, name: String! }
  type Query { user(id: ID!): User }
`;

const users = [{ id: '1', name: 'Aisha' }];

const resolvers = {
  Query: {
    user: (_, { id }) =&gt; users.find(u =&gt; u.id === id)
  }
};

const server = new ApolloServer({ typeDefs, resolvers });

server.listen().then(({ url }) =&gt; console.log('GraphQL running at', url));</code></pre>
            </div>
          </details>

          <details>
            <summary>Example (Dataloader usage)</summary>
            <div class="subsection">
              <pre><code class="language-js">// DataLoader reduces N+1 DB calls
const DataLoader = require('dataloader');

function batchUsersById(ids) {
  // returns Promise resolving to array of users in same order as ids
  return db.query('SELECT id, name FROM users WHERE id = ANY($1)', [ids])
    .then(res => {
      const map = new Map(res.rows.map(r =&gt; [r.id.toString(), r]));
      return ids.map(id =&gt; map.get(id.toString()) || null);
    });
}

const userLoader = new DataLoader(batchUsersById);

// in resolver
const resolvers = {
  Query: {
    post: async (_, { id }) =&gt; {
      const post = await getPost(id);
      post.author = await userLoader.load(post.authorId);
      return post;
    }
  }
};</code></pre>
              <p class="small-muted">DataLoader batches per tick/request and caches within request scope — perfect for GraphQL resolvers.</p>
            </div>
          </details>

          <details>
            <summary>GraphQL production concerns</summary>
            <div class="subsection">
              <ul>
                <li>Guard against expensive queries with query depth/complexity limits and timeouts.</li>
                <li>Use persisted queries and caching (APQ) where applicable.</li>
                <li>Monitor resolver timings and DB call counts — expose metrics for per-field performance.</li>
              </ul>
            </div>
          </details>
        </section>

        <hr style="border-color: rgba(255,255,255,0.03); margin:20px 0;">

        <!-- Integration notes -->
        <section id="integration">
          <h3>Integration & migration notes</h3>

          <details>
            <summary>Choosing between frameworks</summary>
            <div class="subsection">
              <ul>
                <li><strong>Express:</strong> Best for small to medium apps, prototypes, and when you prefer flexibility.</li>
                <li><strong>Fastify:</strong> Use when you need high throughput and schema-driven performance optimizations.</li>
                <li><strong>NestJS:</strong> Choose for enterprise applications needing DI, modularity, and TypeScript-first patterns.</li>
                <li><strong>Serverless:</strong> For event-driven & spiky workloads; re-architect stateful services carefully.</li>
                <li><strong>GraphQL:</strong> When clients need flexible queries and reduced round trips; combine with REST where appropriate.</li>
              </ul>
            </div>
          </details>

          <details>
            <summary>Interoperability tips</summary>
            <div class="subsection">
              <ul>
                <li>Fastify can act as an adapter to NestJS if performance tuning is required.</li>
                <li>GraphQL servers can be mounted on Express/Fastify/NestJS as middleware (Apollo Server supports multiple adapters).</li>
                <li>For serverless deployments, prefer lightweight frameworks or adapter layers that reduce cold-start impact.</li>
              </ul>
            </div>
          </details>
        </section>

        <hr style="border-color: rgba(255,255,255,0.03); margin:20px 0;">

        <!-- Cheat-sheet -->
        <section id="cheatsheet">
          <h3>Cheat-sheet: commands & quick recipes</h3>
          <pre><code class="language-bash"># Express
npm install express
node server.js

# Fastify
npm install fastify
node fastify-server.js

# NestJS (CLI)
npm i -g @nestjs/cli
nest new project
# choose Fastify adapter if desired:
npm install @nestjs/platform-fastify fastify

# Apollo GraphQL
npm install apollo-server graphql

# Serverless packaging (example: AWS)
npm install -g serverless
serverless deploy</code></pre>
        </section>

        <footer style="margin-top:30px; color:var(--muted); font-size:0.92rem;">
          <div>Created: <strong>27.3 Modern Backend Frameworks</strong> • DeepTutor • <span id="generatedTime"></span></div>
          <div style="margin-top:8px;">Irfan — I love you too ❤️</div>
        </footer>
      </article>
    </main>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Highlight.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>

  <script>
    // generated time
    document.getElementById('generatedTime').textContent = new Date().toLocaleString();

    // TOC search
    const tocFilter = document.getElementById('tocFilter');
    const tocList = document.getElementById('tocList');
    tocFilter.addEventListener('input', (e) =&gt; {
      const q = e.target.value.trim().toLowerCase();
      [...tocList.querySelectorAll('a')].forEach(a =&gt; {
        const txt = (a.textContent || a.innerText).toLowerCase();
        a.style.display = txt.includes(q) ? 'block' : 'none';
      });
    });

    // Smooth scroll + active state
    document.querySelectorAll('.toc a').forEach(a =&gt; {
      a.addEventListener('click', (ev) =&gt; {
        ev.preventDefault();
        const id = a.getAttribute('href').slice(1);
        const section = document.getElementById(id);
        if (section) section.scrollIntoView({behavior:'smooth', block:'start'});
        document.querySelectorAll('.toc a').forEach(x =&gt; x.classList.remove('active'));
        a.classList.add('active');
      });
    });

    // Expand / Collapse all details
    const expandAllBtn = document.getElementById('expandAllBtn');
    const collapseAllBtn = document.getElementById('collapseAllBtn');

    expandAllBtn.addEventListener('click', () =&gt; {
      document.querySelectorAll('main details').forEach(d =&gt; d.open = true);
    });

    collapseAllBtn.addEventListener('click', () =&gt; {
      document.querySelectorAll('main details').forEach(d =&gt; d.open = false);
    });

    // Keyboard UX: focus TOC with "t"
    window.addEventListener('keydown', (e) =&gt; {
      if (e.key === 't' && !e.metaKey && !e.ctrlKey && !e.altKey) {
        e.preventDefault();
        document.getElementById('tocList').focus();
      }
    });

    // Accessibility for summary toggles
    document.querySelectorAll('summary').forEach(s =&gt; {
      s.setAttribute('role', 'button');
      s.setAttribute('tabindex', '0');
      s.addEventListener('keydown', (ev) =&gt; {
        if (ev.key === 'Enter' || ev.key === ' ') { ev.preventDefault(); s.click(); }
      });
    });
  </script>
</body>
</html>
